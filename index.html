<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B.Log</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.png" type="image/png">
</head>

<body>
    <header>
        <nav>
            <div class="nav-content">
                <a href="index.html" class="logo">B.Log</a>
                <div class="nav-controls">
                    <button class="theme-toggle" id="themeToggle">üåô</button>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h1>Bem-vindo ao B.Log</h1>
            <p>Descobrindo ideias, compartilhando conhecimento e explorando o mundo da tecnologia</p>
        </section>

        <div class="container lista-artigos" id="listaArtigos">
            <div class="loading-card">
                <div class="loading-shimmer"></div>
                <div class="loading-content">
                    <div class="loading-title"></div>
                    <div class="loading-subtitle"></div>
                </div>
            </div>
            <div class="loading-card">
                <div class="loading-shimmer"></div>
                <div class="loading-content">
                    <div class="loading-title"></div>
                    <div class="loading-subtitle"></div>
                </div>
            </div>
            <div class="loading-card">
                <div class="loading-shimmer"></div>
                <div class="loading-content">
                    <div class="loading-title"></div>
                    <div class="loading-subtitle"></div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="social-links">
                <a href="#" aria-label="GitHub">GitHub</a>
                <a href="#" aria-label="LinkedIn">LinkedIn</a>
                <a href="#" aria-label="Instagram">Instagram</a>
            </div>
            <p class="copyright">&copy; 2025 B.Log - Todos os direitos reservados</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { firebaseConfig } from './config.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const listaArtigos = document.getElementById("listaArtigos");
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        const currentTheme = localStorage.getItem('theme') || 'dark';

        if (currentTheme === 'light') {
            body.setAttribute('data-theme', 'light');
            themeToggle.textContent = '‚òÄÔ∏è';
        }

        themeToggle.addEventListener('click', () => {
            const isDark = !body.hasAttribute('data-theme') || body.getAttribute('data-theme') === 'dark';

            if (isDark) {
                body.setAttribute('data-theme', 'light');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            }
        });

        async function carregarArtigos() {
            try {
                const q = query(collection(db, "artigos"), orderBy("dataPublicacao", "desc"));
                const snapshot = await getDocs(q);

                listaArtigos.innerHTML = "";

                if (snapshot.empty) {
                    listaArtigos.innerHTML = "<div class='empty-state'><h3>Nenhum artigo encontrado</h3><p>Volte em breve para ver novos conte√∫dos!</p></div>";
                    return;
                }

                let delay = 0;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const card = document.createElement("a");
                    card.className = "post-card";
                    card.href = `view.html?id=${doc.id}`;
                    card.style.animationDelay = `${delay}s`;

                    const date = new Date(data.dataPublicacao);
                    const formattedDate = date.toLocaleDateString('pt-BR');
                    const readTime = Math.max(1, Math.ceil(data.conteudo ? data.conteudo.length / 1000 : 3));

                    card.innerHTML = `
                        <div class="post-image-container">
                            <img class="post-image" src="${data.cover}" alt="${data.titulo}" loading="lazy">
                            <div class="post-overlay"></div>
                        </div>
                        <div class="post-content">
                            <h2 class="post-title">${data.titulo}</h2>
                            <p class="post-excerpt">${data.subtitulo}</p>
                            <div class="post-meta">
                                <span class="post-date">üìÖ ${formattedDate}</span>
                                <span class="post-read-time">‚è±Ô∏è ${readTime} min</span>
                            </div>
                            <div class="read-more">
                                <span>Ler mais</span>
                                <span class="arrow">‚Üí</span>
                            </div>
                        </div>
                    `;

                    listaArtigos.appendChild(card);
                    delay += 0.1;
                });

                const cards = document.querySelectorAll('.post-card');
                cards.forEach(card => {
                    card.addEventListener('mouseenter', () => {
                        card.style.willChange = 'transform, box-shadow';
                    });

                    card.addEventListener('mouseleave', () => {
                        setTimeout(() => {
                            card.style.willChange = 'auto';
                        }, 400);
                    });
                });

            } catch (error) {
                listaArtigos.innerHTML = `<div class='error-state'><h3>Erro ao carregar artigos</h3><p>Tente recarregar a p√°gina</p></div>`;
                console.error("Erro ao carregar os artigos: ", error);
            }
        }

        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-in');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.post-card').forEach(card => {
            observer.observe(card);
        });

        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            document.documentElement.style.setProperty('--animation-duration', '0s');
        }

        carregarArtigos();
    </script>
</body>

</html>
